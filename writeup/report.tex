\documentclass[12pt, oneside, a4paper]{article}
% for math symbols
\usepackage{amsmath}
\usepackage{amssymb}
% for inserting images
\usepackage{graphicx}
% for algorithm pseudocode
\usepackage[noend]{algpseudocode}
\usepackage[nothing]{algorithm}
\algrenewcommand{\algorithmicrequire}{\textbf{Input:}}
\algrenewcommand{\algorithmicensure}{\textbf{Output:}}
\algnewcommand\And{\textbf{and} }
% for tables
\usepackage{tabularx}
% for implementation of the array and tabular environments
\usepackage{array}
% Control float placement. Defines a \FloatBarrier command
\usepackage{placeins}
% for derivative commands
\usepackage{physics}
% for multi level lists
\usepackage{outlines} 
% for links in text
\usepackage[colorlinks=true,linkcolor=blue,urlcolor=black,bookmarksopen=true]{hyperref} 
% for contents after pdf is formed
\usepackage{bookmark}
\usepackage{xcolor}
% for code in text
\usepackage{listings}
\usepackage{pythonhighlight}


\newcommand{\vect}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\vt}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\uline}[1]{\underline{#1}}
\newcommand{\tb}[1]{\textbf{#1}}
\newcommand{\ilcode}{\texttt}
\newcommand{\p}{\partial}
\newcommand{\vphi}{\varphi}

\DeclareUnicodeCharacter{2212}{\textendash}

\graphicspath{ {./images/} }

\title{CSDS 341: Final Project Report\\ Questionnaire Website}
\author{Oleksii Fedorenko, David Frost, Matthew Garcia, Preeti Naik}

\begin{document}
    \maketitle
    \section{Background}
    Questionnaires and surveys are very important for understanding and shaping the world. Surveys are one of the main tools for collection and analysis of data for making decisions. For example, United States uses the Census and the American Community Survey to understand how country demographics is shifting and to make decisions about the allocation of resources. Researchers use questionnaires for scientific studies to understand both the social and natural worlds. Psychologists in particular make great use of Likert scales in questionnaires to help build our collective knowledge. 
    \newline\newline\indent Therefore, streamlining the process of collecting and analysing surveys using technology is very beneficial for decision-making. Our application would allow users to create their own questionnaires, distribute and analyse them easily. Additionally, application would allow for streamlining the decision-making process based on the analysis of data to an advanced degree.
    \newline\newline\indent This will be accomplished through the design of the database allowing for multiple functionalities based on the user. With different roles and permissions a user will be able to participate in questionnaires or be the creator of a questionnaire. Then, questionnaires will have a certain amount of questions and these questions will have possible answers created by the maker of the questionnaire. Responses will be recorded and using the relationships in the database queries can be written to analyze the gathered data. This survey tool streamlines the process of creating and answering surveys and allows for data analysis to make decisions or understand the participants choices.
    \section{Data Description}
    \emph{Users} contains information about all of the users, questionnaire creators and reponders, that interact with the website. This data will be obtained through a registration form on the website for creating accounts that asks users for their names, emails, region, and subscription type. At minimum, every user must have at least an email since it serves as a unique identifier that allows them to log in, so the email attribute of \emph{Users} is UNIQUE and NOT NULL.
    \\
    \\
    \emph{Permissions} contains information about all of the permission levels of users for each questionnaire. This data is generated when a questionnaire is made and then the creator of the questionnaire specifies the permissions for the questionnaire for everyone else as they have control over whether other people can view, answer, or edit their questionnaire. \emph{Users} and \emph{Roles} do not have full participation in this ternary relationship.
    \\
    \\
    \emph{Roles} contains information about all of the roles available on the questionnaire website. Each user that is related to a particular questionnaire must have a particular role. However, not every user is related to a particular questionnaire. There are seven different roles we have implemented: \emph{root}, which has all permissions, \emph{creator}, which is for the creators of questionnaires who can edit the questionnaire and view responses but cannot answer their own questionnaire, \emph{moderator}, which can only edit the questionnaire but cannot answer it or view responses, \emph{participant}, which can only respond, \emph{analyst}, which can only view responses, and \emph{guest}, which has no permissions. These roles only need to be added once but there is a table for roles to reduce redundancy. Therefore, we do not expect more tuples to be added to this table unless added by the website's administrator.
    \\
    \\
    \emph{Subscription} is the table that holds all of the info about all of the subscriptions available on the website. Users are limited about how many surveys they are allowed to create depending on their subscription plan. subscription\_id is the primary key and each subscription level has a unique id. Each subscription also has a survey\_limit associated with it that is the number of surveys a user with that subscription is allowed to create. This data is generated only by the administrator of the website as tuples are only added, updated, or deleted whenever the admin changes the subscription offering.
    \\
    \\
    Since our project depends on user-generated data, we had to artificially generate random data to demonstrate how our database works. We generated data using a Python script which created hundreds of users with random names, multiple choice possible answers to questions, and responses to questions and questionnaires.
    \section{ER Diagram}
    \FloatBarrier
    \begin{figure}[H] 
        \centerline{
        \includegraphics[width=\textwidth]{er_diagram.png}
        }
    \end{figure}
    \section{Functional Dependencies}
    For the Users table, the functional dependencies (FDs) are user\_id $\rightarrow$ first\_name, last\_name, email, subscription\_id and email $\rightarrow$ user\_id ,first\_name, last\_name, subscription\_id.
    The first functional dependency exists because user\_id is the primary key for Users and the second functional dependency exists because each email is associated with only one user, making it another candidate key for Users.

    For the Permissions table, the only functional dependency is permission\_id $\rightarrow$ user\_id, questionnaire\_id, role\_id.
    This functional dependency exists because permission\_id is a key for Permissions.

    For the Roles table, the only functional dependency is role\_id $\rightarrow$ edit\_perm, resp\_perm, view\_resp\_perm.
    This functional dependency exists because role\_id is a key for Roles.

    For the Subscription table, the only functional dependency is subscription\_id $\rightarrow$ survey\_limit.
    This functional dependency exists because subscription\_id is a key for Subscription.

    For the Questionnaires table, the only functional dependency is questionnaire\_id $\rightarrow$ number\_of\_questions.
    This functional dependency exists because questionnaire\_id is a key for Questionnaires.

    \newpage
    \section{Functional Dependencies and BCNF}
    \tb{Users} \\
    This entity represents users of the questionnaire website.
    All types of users, including people who create questionnaires
    or answer questionnaires, are in this table. first\_name, last\_name, email, subscription\_id are attributes of the User and there is no FD between them. \\
    R1 = (user\_id, first\_name, last\_name, email, subscription\_id) \\
    F1 = \{user\_id \(\rightarrow\) first\_name, last\_name, email, subscription\_id; email \(\rightarrow\) user\_id, first\_name, last\_name, subscription\_id\} \\
    Since, both user\_id and email are superkeys Users is in BCNF form. 
    \\

    \tb{Permissions} \\
    This entity describes the permission level of a user for each 
    questionnaire, this is part of a ternary relationship between users, questionnaire, and permission. user\_id, questionnaire\_id, role\_id are attributes of Permission and there is no FD in between them. \\
    R2 = (permission\_id, user\_id, questionnaire\_id, role\_id) \\
    F2 = \{permission\_id \(\rightarrow\) user\_id, questionnaire\_id, role\_id\} \\
    Since permission\_id is a superkey Permissions is in BCNF form. 
    \\
    
    \tb{Roles} \\
    This entity describes the roles that are allowed for each permission evel. For each role there are different permissions that are dependent on a true or false value (BIT) in SQL. For each tuple of user and survey the permission level determines what roles they have. edit\_perm, resp\_perm, view\_resp\_perm are all attributes of a role with no FD between them. \\
    R3 = (role\_id, edit\_perm, resp\_perm, view\_resp\_perm) \\
    F3 = \{role\_id \(\rightarrow\) edit\_perm, resp\_perm, view\_resp\_perm\} \\
    Since role\_id is a superkey Roles is in BCNF form. 
    \\

    \tb{Subscription} \\
    Describes the subscription level and how many surveys users are allowed to create at each subscription level. \\
    R4 = (subscription\_id, survey\_limit) \\
    F4 = \{subscription\_id \(\rightarrow\) survey\_limit\} \\
    Since subscription\_id is a superkey Subscription is in BCNF form. 
    \\

    \tb{Questionnaires} \\
    Defines a questionnaire with the unique id that will be bound to a user using the permissions table. \\
    R5 = (questionnaire\_id, number\_of\_questions) \\
    F5 = \{questionnaire\_id, number\_of\_questions\} \\ 
    Since questionnaire\_id is a superkey Questionnaires is in BCNF form. 
    \\

    \tb{Questions} \\
    Determines questions as they are related to each questionnaire. questionnaire\_id, question\_text are attributes of Question with no FD between them. \\
    R5 = (question\_id, questionnaire\_id, question\_text) \\
    F5 = \{question\_id \(\rightarrow\) questionnaire\_id, question\_text\} \\
    Since question\_id is a superkey Questions is in BCNF form. 
    \\

    \tb{Possible\_Answers} \\
    Defines possible answers to each question. e.g. for multiple choice questions, this will have entries for each possible answer, while for questions like rating questions, this place will have the range of rankings available. question\_id, possible\_answer are attributes of an response option with no FD between them. \\
    R6 = (option\_id, question\_id, possible\_answer) \\
    F6 = \{option\_id \(\rightarrow\) question\_id, possible\_answer\} \\
    Since option\_id is a superkey Possible\_Answers is in BCNF form. 
    \\

    \tb{Responses} \\
    Defines the user response to each of the questions and ties them to the unique response option identifier and user id. user\_id, option\_id, date\_time have no FD between them. \\
    R7 = (response\_id, user\_id, option\_id, date\_time) \\
    F7 = \{response\_id $\rightarrow$ user\_id, option\_id, date\_time\} \\
    Since response\_id is a superkey Responses is in BCNF form. 
    \\
    \section{Schemas}
    \begin{lstlisting}[language=SQL, columns=flexible, breaklines]
        CREATE TABLE Users
        (
            user_id INT AUTO_INCREMENT,
            first_name VARCHAR(40),
            last_name VARCHAR(40),
            email VARCHAR(100) NOT NULL UNIQUE,
            subscription_id INT,
            state VARCHAR(10),
            PRIMARY KEY(user_id),
            FOREIGN KEY(subscription_id) REFERENCES Subscription(subscription_id) ON DELETE CASCADE
        );
    \end{lstlisting}
    \begin{lstlisting}[language=SQL, columns=flexible, breaklines]
    CREATE TABLE Permissions
    (
        permission_id INT AUTO_INCREMENT,
        user_id INT,
        questionnaire_id INT,
        role_id varchar(30),
        PRIMARY KEY (permission_id),
        FOREIGN KEY(user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
        FOREIGN KEY(questionnaire_id) REFERENCES Questionnaires(questionnaire_id) ON DELETE CASCADE,
        FOREIGN KEY(role_id) REFERENCES Roles(role_id) ON DELETE CASCADE
    );
    \end{lstlisting}
    \section{Implementation}
    We used MySQL as our database management system. We used Python to create a console app that allows for many interactions with the system from the command line, such as adding a new user, viewing the list of questionnaires on the website, answering a questionnaire, viewing the answers to a particular questionnaire, and creating a questionnaire. This Python app uses MySQL Connector to connect to MySQL, so it may be necessary to run \emph{python -m pip install mysql-connector-python}. We also started developing a Python Flask app using SQLAlchemy to connect to the MySQL database. To run this app, you need to go to the directory csds341\_server and then run \emph{pip install -r requirements.txt} to be able to run it, and then run \emph{flask run}, and then go to your web browser of choice and visit 127.0.01:5000 or localhost:5000 to see it.
    \section{Demo}
    We did a presentation in the last week of class. The slides are in the writeup folder in a file called "CSDS 341 Project Presentation".pdf. We also did a demo to our TA where we showed him our schemas which were significantly updated from our initial report with many additional constraints. We showed him that we successfully created our MySQL database for the project named "csds341_questionnaire" and our progress on our Flask web app and our Python console app for interacting with the questionnaire system from the command line. We also showed him our sample queries and the successful results of running them.
    \section{What We Learned}
    During the course of this project, we learned about how to design our own database system and how to connect the many parts of our project and application together. The lectures taught us how to analyze and describe databases, schemas, and ER diagrams that other people have already made, but the project required us to create our own project and then design a database from scratch for it. The course helped a lot with the theory behind designing a database such as through the rules for ER diagrams and normal forms for schemas, but working on the project gave us the practical experience of actually creating our own database system. We also learned how to use MySQL for our project. Additionally, we learned about how to create web apps using Flask and how to connect MySQL to Python through SQLAlchemy.


\end{document}